# DUPTester

- submit/src: The scripts to run stressing or unit upgrade test for all systems to reproduce bugs.
- submit/systems: Files required to build images of different versions of each systems.
- submit/dataVerify: Script and cases info to verify data we write in paper.
- submit/tests: Directory used to store the data and logs  generated by tests.
- submit/test-migrator-based-python: Script to mirgrate Cassandra unit tests from Java to Python, and generate upgrade tests for each unit test.

# Usage:
1. Download and unzip upgrade_test_tool.tar.gz
tar zxf upgrade_test_tool.tar.gz
curl -s https://packagecloud.io/install/repositories/github/git-lfs/script.deb.sh | sudo bash
sudo apt-get install git-lfs
git lfs migrate import --include="*.tar.gz"
git add .gitattributes 
sudo apt-get update
sudo apt-get install docker-io openjdk-8-jdk python3-docker
sudo chmod 666 /var/run/docker.sock
sudo apt-get install ant maven

2. Run script to verify data
cd submit/dataVerify
python3 dataVerfication.py

3. Run scripts to reproduce bugs found by our upgrade test tool.
    # Prepare:
        a. Checkout the required applications.
	    Cassandra: git clone https://github.com/apache/cassandra
	    Hbase: git clone https://github.com/apache/hbase
	    Hive: git clone https://github.com/apache/hive
	    Kafka: git clone https://github.com/apache/kafka
	    Zookeeper: git clone https://github.com/apache/zookeeper
	    Hdfs: git clone https://github.com/apache/hadoop
	b. Setup configuration to build image for each application and version.
	    Add application source code location to submit/applicationName/applicationName.srclocation.
	c. Install dependencies
	    pip3 install docker numpy pandas

    #Run Script
	cd submit/src
	python3 reproduce_upgrade_bugs.py

4. Run script to migrate unit test for Cassandra.
    #Prepare:
	a. Copy the unit test java file to submit/test-migrator-based-python/java_files.
	   Cassandra unit test is located at: cassandra/test/unit/org/apache/cassandra/
	b. Modify upgrade test configuration in submit/test-migrator-based-python/base_file.py
	c. Install dependencies:
	    pip3 install astunparse cassandra-driver javalang

    #Run Script:
	cd submit/test-migrator-based-python
	python3 multiple_tests_generator.py

	The migrated tests are saved in submit/test-migrator-based-python/migrate_result
 	The generated upgrade tests are saved in submit/src/cass/generated_test
