#!/bin/bash


export GIT="https://github.com/apache/cassandra.git"

if [ -z "$JAVA_HOME" ]
then
    export JAVA_HOME=/usr/lib/jvm/java-8-openjdk-amd64
fi

if [ ! -d ${WORKING_DIR}/build-image ]
then
	echo "directory ${WORKING_DIR}/build-image does not exist"
	exit 1
fi
cd ${WORKING_DIR}/build-image

if [ ! -d cassandra ]
then
	git clone --depth 1 --branch $BRANCH  $GIT cassandra
	if [ $? -ne 0 ]
	then
		echo "git clone failed"
		exit 1
	fi
fi

cd cassandra

git pull origin 
if [ $? -ne 0 ]
then
	echo "git pull failed"
	exit 1
fi
git checkout $BRANCH

ant realclean
ant
if [ $? -ne 0 ]
then
	echo "ant build failed"
	exit 1
fi

cd -

tar -czf cassandra.tar.gz  --exclude-vcs cassandra
